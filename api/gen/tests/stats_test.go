// Code generated by https://github.com/defany/govk. DO NOT EDIT.

package tests

import (
	"github.com/defany/govk/api/gen/models"
	"github.com/defany/govk/api/gen/stats"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
	"github.com/defany/govk/vk"
	"testing"
	"encoding/json"
)

func fillRandomlyStatsGetRequest(r *requests.StatsGetRequest) {
	r.WithGroupId(randInt())
	r.WithAppId(randInt())
	r.WithTimestampFrom(randInt())
	r.WithTimestampTo(randInt())
	r.WithInterval(randString())
	r.WithIntervalsCount(randInt())
	lFilters := randIntn(maxArrayLength + 1)
	r.WithFilters(randStringArr(lFilters))
	lStatsGroups := randIntn(maxArrayLength + 1)
	r.WithStatsGroups(randStringArr(lStatsGroups))
	r.WithExtended(randBool())
}

func TestVKStatsGetSuccess(t *testing.T) {
	params := requests.NewStatsGetRequest()
	fillRandomlyStatsGetRequest(&params)
	var expected models.StatsGetResponse
	fillRandomlyStatsGetResponse(&expected)
	expectedJSON, err := json.Marshal(expected)
	require.NoError(t, err)
	token := randString()
	vk, err := govk.NewVK(token)
	assert.NoError(t, err)
	vk.Api.WithHTTP(NewTestClient(t, "stats.get", params.Params(), expectedJSON))
	resp, err := vk.Api.Stats.StatsGet(params)
	assert.EqualValues(t, expected, resp)
	assert.NoError(t, err)
}

func fillRandomlyStatsGetPostReachRequest(r *requests.StatsGetPostReachRequest) {
	r.WithOwnerId(randString())
	lPostIds := randIntn(maxArrayLength + 1)
	r.WithPostIds(randIntArr(lPostIds))
}

func TestVKStatsGetPostReachSuccess(t *testing.T) {
	params := requests.NewStatsGetPostReachRequest()
	fillRandomlyStatsGetPostReachRequest(&params)
	var expected models.StatsGetPostReachResponse
	fillRandomlyStatsGetPostReachResponse(&expected)
	expectedJSON, err := json.Marshal(expected)
	require.NoError(t, err)
	token := randString()
	vk, err := govk.NewVK(token)
	assert.NoError(t, err)
	vk.Api.WithHTTP(NewTestClient(t, "stats.getPostReach", params.Params(), expectedJSON))
	resp, err := vk.Api.Stats.StatsGetPostReach(params)
	assert.EqualValues(t, expected, resp)
	assert.NoError(t, err)
}

func TestVKStatsTrackVisitorSuccess(t *testing.T) {
	var expected models.BaseOkResponse
	fillRandomlyBaseOkResponse(&expected)
	expectedJSON, err := json.Marshal(expected)
	require.NoError(t, err)
	token := randString()
	vk, err := govk.NewVK(token)
	assert.NoError(t, err)
	vk.Api.WithHTTP(NewTestClient(t, "stats.trackVisitor", nil, expectedJSON))
	resp, err := vk.Api.Stats.StatsTrackVisitor()
	assert.EqualValues(t, expected, resp)
	assert.NoError(t, err)
}

