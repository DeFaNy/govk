// Code generated by https://github.com/defany/govk. DO NOT EDIT.

package tests

import (
	"encoding/json"
	"github.com/defany/govk/api/gen/models"
	"github.com/defany/govk/api/gen/stats"
	"github.com/defany/govk/pkg/random"
	"github.com/defany/govk/vk"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
	"testing"
)

func fillRandomlyStatsGetRequest(r *requests.StatsGetRequest) {
	r.WithGroupId(random.Int())
	r.WithAppId(random.Int())
	r.WithTimestampFrom(random.Int())
	r.WithTimestampTo(random.Int())
	r.WithInterval(random.String())
	r.WithIntervalsCount(random.Int())
	lFilters := random.IntDiapason(random.MaxArrayLength + 1)
	r.WithFilters(random.StringArr(lFilters))
	lStatsGroups := random.IntDiapason(random.MaxArrayLength + 1)
	r.WithStatsGroups(random.StringArr(lStatsGroups))
	r.WithExtended(random.Bool())
}

func TestVKStatsGetSuccess(t *testing.T) {
	params := requests.NewStatsGetRequest()
	fillRandomlyStatsGetRequest(&params)
	var expected models.StatsGetResponse
	fillRandomlyStatsGetResponse(&expected)
	expectedJSON, err := json.Marshal(expected)
	require.NoError(t, err)
	token := random.String()
	vk, err := govk.NewVK(token)
	assert.NoError(t, err)
	vk.Api.WithHTTP(NewTestClient(t, "stats.get", params.Params(), expectedJSON))
	resp, err := vk.Api.Stats.StatsGet(params)
	assert.EqualValues(t, expected, resp)
	assert.NoError(t, err)
}

func fillRandomlyStatsGetPostReachRequest(r *requests.StatsGetPostReachRequest) {
	r.WithOwnerId(random.String())
	lPostIds := random.IntDiapason(random.MaxArrayLength + 1)
	r.WithPostIds(random.IntArr(lPostIds))
}

func TestVKStatsGetPostReachSuccess(t *testing.T) {
	params := requests.NewStatsGetPostReachRequest()
	fillRandomlyStatsGetPostReachRequest(&params)
	var expected models.StatsGetPostReachResponse
	fillRandomlyStatsGetPostReachResponse(&expected)
	expectedJSON, err := json.Marshal(expected)
	require.NoError(t, err)
	token := random.String()
	vk, err := govk.NewVK(token)
	assert.NoError(t, err)
	vk.Api.WithHTTP(NewTestClient(t, "stats.getPostReach", params.Params(), expectedJSON))
	resp, err := vk.Api.Stats.StatsGetPostReach(params)
	assert.EqualValues(t, expected, resp)
	assert.NoError(t, err)
}

func TestVKStatsTrackVisitorSuccess(t *testing.T) {
	var expected models.BaseOkResponse
	fillRandomlyBaseOkResponse(&expected)
	expectedJSON, err := json.Marshal(expected)
	require.NoError(t, err)
	token := random.String()
	vk, err := govk.NewVK(token)
	assert.NoError(t, err)
	vk.Api.WithHTTP(NewTestClient(t, "stats.trackVisitor", nil, expectedJSON))
	resp, err := vk.Api.Stats.StatsTrackVisitor()
	assert.EqualValues(t, expected, resp)
	assert.NoError(t, err)
}
